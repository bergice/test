<!DOCTYPE html>
<html>
<head>
	<title>Ping Pong Game</title>
	<link rel="stylesheet" href="css/app.css">
</head>
<body>
	<canvas id="canvas"></canvas>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript" src="js/resize.js"></script>
	<script type="text/javascript" src="js/pad.js"></script>
	<script type="text/javascript" src="js/ball.js"></script>
	<script type="text/javascript">
		const borderWidth = 20;
		const margin = 10;

		let player1;
		let player2;
		let ball;

		app.restartMatch = function() {
			ball.resetPosition();
			player1.resetPosition();
			player2.resetPosition();
		}

		app.onInit = function(){
			app.reset();
			app.initialised = true;
		};

		// pause toggle function
		app.togglePause = function() {
			app.paused = !app.paused;
			console.log(`Game paused: ${app.paused}`);
		}

		// reset function
		app.reset = function() {
			this.nodes = [];

			// add nodes
			this.nodes.push({
				id : 'midline',
				x  : app.width / 2 - (borderWidth) / 2,
				y  : 0,
				width  : borderWidth,
				height : app.height,
				color  : 'white',
			});
			this.nodes.push({
				id : 'top',
				x  : 0,
				y  : -borderWidth,
				width  : app.width,
				height : borderWidth,
				color  : 'white',
			});
			this.nodes.push({
				id : 'bottom',
				x  : 0,
				y  : app.height,
				width  : app.width,
				height : borderWidth,
				color  : 'white',
			});

			player1 = new Pad('player1', margin, app.height / 2 - (padHeight / 2), 'w', 's');
			player2 = new Pad('player2', app.width - margin - padWidth, app.height / 2 - (padHeight / 2), 'ArrowUp', 'ArrowDown');
			ball = new Ball('ball', app.width / 2 - (ballSize / 2), app.height / 2 - (ballSize / 2));

			this.nodes.push(player1);
			this.nodes.push(player2);
			this.nodes.push(ball);

			console.log('Game reset...');
		}

		// add app key bindings
		window.addEventListener("keyup", function(event) {
			if (event.code === 'Space') {
				app.togglePause();
			} else if (event.key === 'r') {
				app.reset();
			}
		});

		app.onUpdate = function(time){
			if (!app.initialised) {
				return;
			}

			if (!app.paused) {
				// update
				player1.update(time);
				player2.update(time);
				ball.update(time);
			}

			// draw
			app.context.textAlign = 'left';
			app.context.fillText(`Score: ${player1.getScore()}`, margin, margin * 2, app.width / 2);
			app.context.textAlign = 'right';
			app.context.fillText(`Score: ${player2.getScore()}`, app.width - margin, margin * 2, app.width / 2);
		};
	</script>
</body>
</html>